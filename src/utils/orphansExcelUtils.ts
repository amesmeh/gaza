import * as XLSX from 'xlsx';
import { Orphan, Martyr } from '../types';

// ุชุญููู ุฑูู Excel ุงูุชุณูุณูู ุฅูู ุชุงุฑูุฎ
const excelDateToJSDate = (excelDate: number): Date => {
  const excelEpoch = new Date(1899, 11, 30);
  const jsDate = new Date(excelEpoch.getTime() + excelDate * 24 * 60 * 60 * 1000);
  return jsDate;
};

// ุญุณุงุจ ุงูุนูุฑ ูู ุชุงุฑูุฎ ุงููููุงุฏ
const calculateAge = (birthDate: string): number => {
  if (!birthDate) return 0;
  
  const today = new Date();
  const birth = new Date(birthDate);
  let age = today.getFullYear() - birth.getFullYear();
  const monthDiff = today.getMonth() - birth.getMonth();
  
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--;
  }
  
  return age;
};

// ุฏุงูุฉ ุดุงููุฉ ูุชุญููู ุฃู ุตูุบุฉ ุชุงุฑูุฎ ุฅูู ISO
const parseAnyDateFormat = (dateValue: any): string | null => {
  if (!dateValue) return null;
  
  try {
    // ุฅุฐุง ูุงู ุฑูู (Excel serial date)
    if (typeof dateValue === 'number') {
      if (dateValue > 1 && dateValue < 100000) {
        const jsDate = excelDateToJSDate(dateValue);
        return jsDate.toISOString().split('T')[0];
      }
    }
    
    // ุฅุฐุง ูุงู ูุงุฆู Date
    if (dateValue instanceof Date && !isNaN(dateValue.getTime())) {
      return dateValue.toISOString().split('T')[0];
    }
    
    // ุฅุฐุง ูุงู ูุตุ ุฌุฑุจ ุตูุบ ูุฎุชููุฉ
    if (typeof dateValue === 'string') {
      const dateStr = dateValue.toString().trim();
      
      // ุฌุฑุจ ุงูุชุญููู ุงููุจุงุดุฑ ุฃููุงู
      let date = new Date(dateStr);
      if (!isNaN(date.getTime())) {
        return date.toISOString().split('T')[0];
      }
      
      // ุตูุบ ูุฎุชููุฉ ููุชุงุฑูุฎ
      const dateFormats = [
        /^(\d{4})-(\d{1,2})-(\d{1,2})$/,
        /^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/,
        /^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/,
        /^(\d{1,2})\.(\d{1,2})\.(\d{4})$/,
        /^(\d{4})\.(\d{1,2})\.(\d{1,2})$/
      ];
      
      for (const format of dateFormats) {
        const match = dateStr.match(format);
        if (match) {
          let year, month, day;
          
          if (format.source.startsWith('^(\\d{4})')) {
            year = parseInt(match[1]);
            month = parseInt(match[2]);
            day = parseInt(match[3]);
          } else if (format.source.includes('(\\d{4})$')) {
            day = parseInt(match[1]);
            month = parseInt(match[2]);
            year = parseInt(match[3]);
          } else {
            month = parseInt(match[1]);
            day = parseInt(match[2]);
            year = parseInt(match[3]);
          }
          
          if (year >= 1900 && year <= 2100 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
            date = new Date(year, month - 1, day);
            if (!isNaN(date.getTime())) {
              return date.toISOString().split('T')[0];
            }
          }
        }
      }
    }
    
    return null;
  } catch (error) {
    console.warn('ุฎุทุฃ ูู ุชุญููู ุงูุชุงุฑูุฎ:', dateValue, error);
    return null;
  }
};

// ุฅูุดุงุก ูุงูุจ Excel ููุฃูุชุงู
export const createOrphansTemplate = (martyrs: Martyr[]) => {
  const templateData = [
    {
      'ุงุณู ุงููุชูู': 'ูุซุงู: ุฃุญูุฏ ูุญูุฏ ุงูุฎุงูุฏู',
      'ุฑูู ูููุฉ ุงููุชูู': '123456791',
      'ุงูุฌูุณ': 'ุฐูุฑ',
      'ุชุงุฑูุฎ ุงููููุงุฏ': '2015-05-10',
      'ุงูุญุงูุฉ ุงูุตุญูุฉ': 'ุฌูุฏุฉ',
      'ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ': 'ุงุจุชุฏุงุฆู',
      'ุฑูู ูููุฉ ุงูุดููุฏ': martyrs[0]?.nationalId || '111222333',
      'ุงุณู ุงูุดููุฏ/ุงููุชููู': martyrs[0]?.name || 'ุฃุญูุฏ ูุญูุฏ ุงูุณุงูู',
      'ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ': martyrs[0]?.martyrdomDate || '2024-01-15',
      'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ': 1,
      'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ': 2,
      'ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู': 'ูุญูุฏ ุฃุญูุฏ ุงูุณุงูู',
      'ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู': 'ุนู',
      'ุงูุนููุงู': 'ุงูุฑุจุงุท - ุดุงุฑุน ุงูุดูุฏุงุก',
      'ุฑูู ุงูุฌูุงู': '0597111112',
      'ููุงุญุธุงุช': 'ูุญุชุงุฌ ุฅูู ุฏุนู ููุณู'
    }
  ];

  // ุฅูุดุงุก ูุฑูุฉ ุงูุนูู
  const worksheet = XLSX.utils.json_to_sheet(templateData);

  // ุชุนููู ุงุชุฌุงู RTL ูููุฑูุฉ
  worksheet['!dir'] = 'rtl';

  // ุชุนููู ุนุฑุถ ุงูุฃุนูุฏุฉ
  const columnWidths = [
    { wch: 25 }, // ุงุณู ุงููุชูู
    { wch: 20 }, // ุฑูู ูููุฉ ุงููุชูู
    { wch: 10 }, // ุงูุฌูุณ
    { wch: 15 }, // ุชุงุฑูุฎ ุงููููุงุฏ
    { wch: 15 }, // ุงูุญุงูุฉ ุงูุตุญูุฉ
    { wch: 15 }, // ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ
    { wch: 20 }, // ุฑูู ูููุฉ ุงูุดููุฏ
    { wch: 25 }, // ุงุณู ุงูุดููุฏ/ุงููุชููู
    { wch: 15 }, // ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ
    { wch: 15 }, // ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ
    { wch: 15 }, // ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ
    { wch: 25 }, // ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู
    { wch: 20 }, // ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู
    { wch: 25 }, // ุงูุนููุงู
    { wch: 15 }, // ุฑูู ุงูุฌูุงู
    { wch: 30 }  // ููุงุญุธุงุช
  ];
  worksheet['!cols'] = columnWidths;

  // ุฅูุดุงุก ูุฑูุฉ ุงูุดูุฏุงุก ุงููุชุงุญูู
  const martyrsData = martyrs.map(martyr => ({
    'ุฑูู ุงูุดููุฏ': martyr.id,
    'ุงุณู ุงูุดููุฏ': martyr.name,
    'ุฑูู ูููุฉ ุงูุดููุฏ': martyr.nationalId,
    'ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ': martyr.martyrdomDate,
    'ุงุณู ุงููููู': martyr.agentName,
    'ุฑูู ูุงุชู ุงููููู': martyr.agentPhone
  }));

  const martyrsWorksheet = XLSX.utils.json_to_sheet(martyrsData);
  martyrsWorksheet['!dir'] = 'rtl';
  martyrsWorksheet['!cols'] = [
    { wch: 12 }, // ุฑูู ุงูุดููุฏ
    { wch: 25 }, // ุงุณู ุงูุดููุฏ
    { wch: 20 }, // ุฑูู ูููุฉ ุงูุดููุฏ
    { wch: 15 }, // ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ
    { wch: 25 }, // ุงุณู ุงููููู
    { wch: 15 }  // ุฑูู ูุงุชู ุงููููู
  ];

  // ุฅูุดุงุก ูุฑูุฉ ุงูุญุงูุงุช ุงูุตุญูุฉ ูุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ
  const statusesData = [
    { 'ุงูููุน': 'ุงูุญุงูุงุช ุงูุตุญูุฉ', 'ุงููููุฉ': 'ุฌูุฏุฉ', 'ุงููุตู': 'ุงูุญุงูุฉ ุงูุตุญูุฉ ุฌูุฏุฉ' },
    { 'ุงูููุน': 'ุงูุญุงูุงุช ุงูุตุญูุฉ', 'ุงููููุฉ': 'ูุชูุณุทุฉ', 'ุงููุตู': 'ุงูุญุงูุฉ ุงูุตุญูุฉ ูุชูุณุทุฉ' },
    { 'ุงูููุน': 'ุงูุญุงูุงุช ุงูุตุญูุฉ', 'ุงููููุฉ': 'ุถุนููุฉ', 'ุงููุตู': 'ุงูุญุงูุฉ ุงูุตุญูุฉ ุถุนููุฉ' },
    { 'ุงูููุน': 'ุงูุญุงูุงุช ุงูุตุญูุฉ', 'ุงููููุฉ': 'ุณูุฆุฉ', 'ุงููุตู': 'ุงูุญุงูุฉ ุงูุตุญูุฉ ุณูุฆุฉ' },
    { 'ุงูููุน': 'ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ', 'ุงููููุฉ': 'ุฑูุถุฉ', 'ุงููุตู': 'ูุฑุญูุฉ ุฑูุงุถ ุงูุฃุทูุงู' },
    { 'ุงูููุน': 'ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ', 'ุงููููุฉ': 'ุงุจุชุฏุงุฆู', 'ุงููุตู': 'ุงููุฑุญูุฉ ุงูุงุจุชุฏุงุฆูุฉ' },
    { 'ุงูููุน': 'ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ', 'ุงููููุฉ': 'ุฅุนุฏุงุฏู', 'ุงููุตู': 'ุงููุฑุญูุฉ ุงูุฅุนุฏุงุฏูุฉ' },
    { 'ุงูููุน': 'ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ', 'ุงููููุฉ': 'ุซุงููู', 'ุงููุตู': 'ุงููุฑุญูุฉ ุงูุซุงูููุฉ' },
    { 'ุงูููุน': 'ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ', 'ุงููููุฉ': 'ุฌุงูุนู', 'ุงููุตู': 'ุงููุฑุญูุฉ ุงูุฌุงูุนูุฉ' },
    { 'ุงูููุน': 'ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ', 'ุงููููุฉ': 'ุบูุฑ ูุชุนูู', 'ุงููุตู': 'ุบูุฑ ููุชุญู ุจุงูุชุนููู' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฃุจ', 'ุงููุตู': 'ุงูุฃุจ' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฃู', 'ุงููุตู': 'ุงูุฃู' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฌุฏ', 'ุงููุตู': 'ุงูุฌุฏ' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฌุฏุฉ', 'ุงููุตู': 'ุงูุฌุฏุฉ' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุนู', 'ุงููุตู': 'ุงูุนู' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุนูุฉ', 'ุงููุตู': 'ุงูุนูุฉ' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฎุงู', 'ุงููุตู': 'ุงูุฎุงู' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฎุงูุฉ', 'ุงููุตู': 'ุงูุฎุงูุฉ' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฃุฎ', 'ุงููุตู': 'ุงูุฃุฎ' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฃุฎุช', 'ุงููุตู': 'ุงูุฃุฎุช' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ูุฑูุจ', 'ุงููุตู': 'ูุฑูุจ ุขุฎุฑ' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ูุตู ูุงูููู', 'ุงููุตู': 'ูุตู ูุงูููู ูุนูู' },
    { 'ุงูููุน': 'ุตูุงุช ูุฑุงุจุฉ ุงููุตู', 'ุงููููุฉ': 'ุฃุฎุฑู', 'ุงููุตู': 'ุตูุฉ ูุฑุงุจุฉ ุฃุฎุฑู' }
  ];

  const statusesWorksheet = XLSX.utils.json_to_sheet(statusesData);
  statusesWorksheet['!dir'] = 'rtl';
  statusesWorksheet['!cols'] = [
    { wch: 20 }, // ุงูููุน
    { wch: 20 }, // ุงููููุฉ
    { wch: 40 }  // ุงููุตู
  ];

  // ุฅูุดุงุก ูุฑูุฉ ุงูุชุนูููุงุช
  const instructionsData = [
    { 'ุงูุชุนูููุงุช': '๐ ููุงุญุธุงุช ูููุฉ ูููุก ุจูุงูุงุช ุงูุฃูุชุงู:' },
    { 'ุงูุชุนูููุงุช': '' },
    { 'ุงูุชุนูููุงุช': 'โ ุงูุญููู ุงููุทููุจุฉ:' },
    { 'ุงูุชุนูููุงุช': '1. ุงุณู ุงููุชูู (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '2. ุฑูู ูููุฉ ุงููุชูู (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '3. ุงูุฌูุณ (ูุทููุจ) - ุฐูุฑ ุฃู ุฃูุซู' },
    { 'ุงูุชุนูููุงุช': '4. ุชุงุฑูุฎ ุงููููุงุฏ (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '5. ุงูุญุงูุฉ ุงูุตุญูุฉ (ูุทููุจ) - ุฌูุฏุฉุ ูุชูุณุทุฉุ ุถุนููุฉุ ุณูุฆุฉ' },
    { 'ุงูุชุนูููุงุช': '6. ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ (ูุทููุจ) - ุฑูุถุฉุ ุงุจุชุฏุงุฆูุ ุฅุนุฏุงุฏูุ ุซุงูููุ ุฌุงูุนูุ ุบูุฑ ูุชุนูู' },
    { 'ุงูุชุนูููุงุช': '7. ุฑูู ูููุฉ ุงูุดููุฏ (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '8. ุงุณู ุงูุดููุฏ/ุงููุชููู (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '9. ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '10. ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '11. ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '12. ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '13. ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '14. ุงูุนููุงู (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '15. ุฑูู ุงูุฌูุงู (ูุทููุจ)' },
    { 'ุงูุชุนูููุงุช': '16. ุงูููุงุญุธุงุช (ุงุฎุชูุงุฑู)' },
    { 'ุงูุชุนูููุงุช': '' },
    { 'ุงูุชุนูููุงุช': '๐ ุตูุบ ุงูุชุงุฑูุฎ ุงููุฏุนููุฉ:' },
    { 'ุงูุชุนูููุงุช': 'โข 2015-05-10 (ุงูุณูุฉ-ุงูุดูุฑ-ุงูููู) - ุงูุฃูุถู' },
    { 'ุงูุชุนูููุงุช': 'โข 10/5/2015 (ุงูููู/ุงูุดูุฑ/ุงูุณูุฉ)' },
    { 'ุงูุชุนูููุงุช': 'โข 10-5-2015 (ุงูููู-ุงูุดูุฑ-ุงูุณูุฉ)' },
    { 'ุงูุชุนูููุงุช': 'โข 10.5.2015 (ุงูููู.ุงูุดูุฑ.ุงูุณูุฉ)' },
    { 'ุงูุชุนูููุงุช': '' },
    { 'ุงูุชุนูููุงุช': '๐ฅ ุจูุงูุงุช ุงูุดูุฏุงุก:' },
    { 'ุงูุชุนูููุงุช': 'โข ูููู ุงูุงุณุชูุงุฏุฉ ูู ุจูุงูุงุช ุงูุดูุฏุงุก ุงูููุฌูุฏุฉ ูู ุงููุธุงู' },
    { 'ุงูุชุนูููุงุช': 'โข ุฑุงุฌุน ูุฑูุฉ "ุงูุดูุฏุงุก ุงููุชุงุญูู" ููุชูุงุตูู' },
    { 'ุงูุชุนูููุงุช': 'โข ูููู ุฅุฏุฎุงู ุจูุงูุงุช ุดููุฏ ุบูุฑ ูุณุฌู ูู ุงููุธุงู' },
    { 'ุงูุชุนูููุงุช': '' },
    { 'ุงูุชุนูููุงุช': '๐ ูุนูููุงุช ุชููุงุฆูุฉ:' },
    { 'ุงูุชุนูููุงุช': 'โข ุงูุนูุฑ ุณูุชู ุญุณุงุจู ุชููุงุฆูุงู ูู ุชุงุฑูุฎ ุงููููุงุฏ' },
    { 'ุงูุชุนูููุงุช': 'โข ูุง ุชุชุฑู ุฎุงูุงุช ูุงุฑุบุฉ ูู ุงูุญููู ุงููุทููุจุฉ' },
    { 'ุงูุชุนูููุงุช': '' },
    { 'ุงูุชุนูููุงุช': '๐ก ูุตุงุฆุญ ูุชุฌูุจ ุงูุฃุฎุทุงุก:' },
    { 'ุงูุชุนูููุงุช': 'โข ุชุฃูุฏ ูู ุตุญุฉ ุฃุฑูุงู ุงููููุฉ ูุจู ุงูุงุณุชูุฑุงุฏ' },
    { 'ุงูุชุนูููุงุช': 'โข ุงุณุชุฎุฏู ุตูุบุฉ ุงูุชุงุฑูุฎ ุงูููุถูุฉ: YYYY-MM-DD' },
    { 'ุงูุชุนูููุงุช': 'โข ุชุฃูุฏ ูู ูุชุงุจุฉ ุงูุญุงูุฉ ุงูุตุญูุฉ ูุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ ุจุงูุถุจุท ููุง ูู ููุชูุจ' },
    { 'ุงูุชุนูููุงุช': 'โข ูู ุญุงูุฉ ูุฌูุฏ ุฃุฎุทุงุกุ ุณูุชู ุชุญููู ููู ุงูุฃุฎุทุงุก ุชููุงุฆูุงู' }
  ];

  const instructionsWorksheet = XLSX.utils.json_to_sheet(instructionsData);
  instructionsWorksheet['!dir'] = 'rtl';
  instructionsWorksheet['!cols'] = [{ wch: 80 }];

  // ุฅูุดุงุก ูุชุงุจ ุงูุนูู
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'ูุงูุจ ุงูุฃูุชุงู');
  XLSX.utils.book_append_sheet(workbook, martyrsWorksheet, 'ุงูุดูุฏุงุก ุงููุชุงุญูู');
  XLSX.utils.book_append_sheet(workbook, statusesWorksheet, 'ุงูุญุงูุงุช ูุงููุฑุงุญู');
  XLSX.utils.book_append_sheet(workbook, instructionsWorksheet, 'ุงูุชุนูููุงุช');

  // ุชุนููู ุฎุตุงุฆุต RTL ูููุชุงุจ
  workbook.Props = {
    Title: 'ูุงูุจ ุงูุฃูุชุงู',
    Subject: 'ูุงูุจ ูุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุฃูุชุงู',
    Author: 'ูุธุงู ุงููุณุงุนุฏุงุช - ูุทุงุน ุบุฒุฉ',
    CreatedDate: new Date()
  };

  return workbook;
};

// ุชุตุฏูุฑ ุจูุงูุงุช ุงูุฃูุชุงู ุฅูู Excel
export const exportOrphansToExcel = (orphans: Orphan[]) => {
  const exportData = orphans.map(orphan => ({
    'ุงุณู ุงููุชูู': orphan.name,
    'ุฑูู ูููุฉ ุงููุชูู': orphan.nationalId,
    'ุงูุฌูุณ': orphan.gender === 'male' ? 'ุฐูุฑ' : 'ุฃูุซู',
    'ุชุงุฑูุฎ ุงููููุงุฏ': orphan.birthDate,
    'ุงูุนูุฑ': orphan.age,
    'ุงูุญุงูุฉ ุงูุตุญูุฉ': orphan.healthStatus,
    'ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ': orphan.educationalStage,
    'ุฑูู ูููุฉ ุงูุดููุฏ': orphan.martyrNationalId,
    'ุงุณู ุงูุดููุฏ/ุงููุชููู': orphan.martyrName,
    'ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ': orphan.martyrdomDate,
    'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ': orphan.maleSiblingsCount,
    'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ': orphan.femaleSiblingsCount,
    'ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู': orphan.guardianName,
    'ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู': orphan.guardianRelationship,
    'ุงูุนููุงู': orphan.address,
    'ุฑูู ุงูุฌูุงู': orphan.phone,
    'ููุงุญุธุงุช': orphan.notes || '',
    'ุชุงุฑูุฎ ุงูุชุณุฌูู': new Date(orphan.createdAt).toLocaleDateString('ar-EG'),
    'ุขุฎุฑ ุชุญุฏูุซ': new Date(orphan.updatedAt).toLocaleDateString('ar-EG')
  }));

  const worksheet = XLSX.utils.json_to_sheet(exportData);
  worksheet['!dir'] = 'rtl';
  
  // ุชุนููู ุนุฑุถ ุงูุฃุนูุฏุฉ
  worksheet['!cols'] = [
    { wch: 25 }, // ุงุณู ุงููุชูู
    { wch: 20 }, // ุฑูู ูููุฉ ุงููุชูู
    { wch: 10 }, // ุงูุฌูุณ
    { wch: 15 }, // ุชุงุฑูุฎ ุงููููุงุฏ
    { wch: 10 }, // ุงูุนูุฑ
    { wch: 15 }, // ุงูุญุงูุฉ ุงูุตุญูุฉ
    { wch: 15 }, // ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ
    { wch: 20 }, // ุฑูู ูููุฉ ุงูุดููุฏ
    { wch: 25 }, // ุงุณู ุงูุดููุฏ/ุงููุชููู
    { wch: 15 }, // ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ
    { wch: 15 }, // ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ
    { wch: 15 }, // ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ
    { wch: 25 }, // ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู
    { wch: 20 }, // ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู
    { wch: 25 }, // ุงูุนููุงู
    { wch: 15 }, // ุฑูู ุงูุฌูุงู
    { wch: 30 }, // ููุงุญุธุงุช
    { wch: 15 }, // ุชุงุฑูุฎ ุงูุชุณุฌูู
    { wch: 15 }  // ุขุฎุฑ ุชุญุฏูุซ
  ];

  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'ุจูุงูุงุช ุงูุฃูุชุงู');

  workbook.Props = {
    Title: 'ุจูุงูุงุช ุงูุฃูุชุงู',
    Subject: 'ุชุตุฏูุฑ ุจูุงูุงุช ุงูุฃูุชุงู',
    Author: 'ูุธุงู ุงููุณุงุนุฏุงุช - ูุทุงุน ุบุฒุฉ',
    CreatedDate: new Date()
  };

  return workbook;
};

// ูุฑุงุกุฉ ููู Excel ูุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุฃูุชุงู ูุน ุงูุชุญูู ูู ุงูุฃุฎุทุงุก
export const importOrphansFromExcel = (file: File, martyrs: Martyr[]): Promise<{
  validOrphans: Partial<Orphan>[];
  errors: Array<{row: number, field: string, message: string}>;
}> => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    
    reader.onload = (e) => {
      try {
        const data = new Uint8Array(e.target?.result as ArrayBuffer);
        const workbook = XLSX.read(data, { 
          type: 'array', 
          cellDates: false,
          raw: false,
          dateNF: 'yyyy-mm-dd'
        });
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
          raw: false,
          defval: '',
          blankrows: false
        });

        const validOrphans: Partial<Orphan>[] = [];
        const errors: Array<{row: number, field: string, message: string}> = [];

        // ุงูุญุงูุงุช ุงูุตุญูุฉ ุงููุชุงุญุฉ
        const healthStatuses = [
          'ุฌูุฏุฉ',
          'ูุชูุณุทุฉ',
          'ุถุนููุฉ',
          'ุณูุฆุฉ'
        ];

        // ุงููุฑุงุญู ุงูุฏุฑุงุณูุฉ ุงููุชุงุญุฉ
        const educationalStages = [
          'ุฑูุถุฉ',
          'ุงุจุชุฏุงุฆู',
          'ุฅุนุฏุงุฏู',
          'ุซุงููู',
          'ุฌุงูุนู',
          'ุบูุฑ ูุชุนูู'
        ];

        // ุตูุงุช ุงููุฑุงุจุฉ ุงููุชุงุญุฉ
        const guardianRelationships = [
          'ุฃุจ',
          'ุฃู',
          'ุฌุฏ',
          'ุฌุฏุฉ',
          'ุนู',
          'ุนูุฉ',
          'ุฎุงู',
          'ุฎุงูุฉ',
          'ุฃุฎ',
          'ุฃุฎุช',
          'ูุฑูุจ',
          'ูุตู ูุงูููู',
          'ุฃุฎุฑู'
        ];

        jsonData.forEach((row: any, index: number) => {
          const rowNumber = index + 2;
          const orphan: Partial<Orphan> = {};
          let hasErrors = false;

          // ุงุณู ุงููุชูู (ูุทููุจ)
          const name = row['ุงุณู ุงููุชูู'] || '';
          if (!name || name.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุงุณู ุงููุชูู', message: 'ุงุณู ุงููุชูู ูุทููุจ'});
            hasErrors = true;
          } else {
            orphan.name = name.toString().trim();
          }

          // ุฑูู ูููุฉ ุงููุชูู (ูุทููุจ)
          const nationalId = row['ุฑูู ูููุฉ ุงููุชูู'] || '';
          if (!nationalId || nationalId.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุฑูู ูููุฉ ุงููุชูู', message: 'ุฑูู ูููุฉ ุงููุชูู ูุทููุจ'});
            hasErrors = true;
          } else {
            orphan.nationalId = nationalId.toString().trim();
          }

          // ุงูุฌูุณ (ูุทููุจ)
          const gender = row['ุงูุฌูุณ'] || '';
          if (!gender || gender.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุงูุฌูุณ', message: 'ุงูุฌูุณ ูุทููุจ'});
            hasErrors = true;
          } else {
            const genderStr = gender.toString().trim();
            if (genderStr === 'ุฐูุฑ' || genderStr.toLowerCase() === 'male') {
              orphan.gender = 'male';
            } else if (genderStr === 'ุฃูุซู' || genderStr.toLowerCase() === 'female') {
              orphan.gender = 'female';
            } else {
              errors.push({
                row: rowNumber, 
                field: 'ุงูุฌูุณ', 
                message: `ุงูุฌูุณ ุบูุฑ ุตุญูุญ: "${genderStr}". ุงูููู ุงููุชุงุญุฉ: ุฐูุฑุ ุฃูุซู`
              });
              hasErrors = true;
            }
          }

          // ุชุงุฑูุฎ ุงููููุงุฏ (ูุทููุจ)
          const birthDateValue = row['ุชุงุฑูุฎ ุงููููุงุฏ'];
          if (!birthDateValue) {
            errors.push({row: rowNumber, field: 'ุชุงุฑูุฎ ุงููููุงุฏ', message: 'ุชุงุฑูุฎ ุงููููุงุฏ ูุทููุจ'});
            hasErrors = true;
          } else {
            const parsedDate = parseAnyDateFormat(birthDateValue);
            if (!parsedDate) {
              errors.push({
                row: rowNumber, 
                field: 'ุชุงุฑูุฎ ุงููููุงุฏ', 
                message: `ุชุงุฑูุฎ ุงููููุงุฏ ุบูุฑ ุตุญูุญ: "${birthDateValue}". ุงุณุชุฎุฏู ุตูุบุฉ ูุซู: 2015-05-10 ุฃู 10/5/2015`
              });
              hasErrors = true;
            } else {
              orphan.birthDate = parsedDate;
              orphan.age = calculateAge(parsedDate);
            }
          }

          // ุงูุญุงูุฉ ุงูุตุญูุฉ (ูุทููุจ)
          const healthStatus = row['ุงูุญุงูุฉ ุงูุตุญูุฉ'] || '';
          if (!healthStatus || healthStatus.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุงูุญุงูุฉ ุงูุตุญูุฉ', message: 'ุงูุญุงูุฉ ุงูุตุญูุฉ ูุทููุจุฉ'});
            hasErrors = true;
          } else {
            const healthStatusStr = healthStatus.toString().trim();
            if (healthStatuses.includes(healthStatusStr)) {
              orphan.healthStatus = healthStatusStr;
            } else {
              errors.push({
                row: rowNumber, 
                field: 'ุงูุญุงูุฉ ุงูุตุญูุฉ', 
                message: `ุงูุญุงูุฉ ุงูุตุญูุฉ ุบูุฑ ุตุญูุญุฉ: "${healthStatusStr}". ุงูููู ุงููุชุงุญุฉ: ${healthStatuses.join(', ')}`
              });
              hasErrors = true;
            }
          }

          // ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ (ูุทููุจ)
          const educationalStage = row['ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ'] || '';
          if (!educationalStage || educationalStage.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ', message: 'ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ ูุทููุจุฉ'});
            hasErrors = true;
          } else {
            const educationalStageStr = educationalStage.toString().trim();
            if (educationalStages.includes(educationalStageStr)) {
              orphan.educationalStage = educationalStageStr;
            } else {
              errors.push({
                row: rowNumber, 
                field: 'ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ', 
                message: `ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ ุบูุฑ ุตุญูุญุฉ: "${educationalStageStr}". ุงูููู ุงููุชุงุญุฉ: ${educationalStages.join(', ')}`
              });
              hasErrors = true;
            }
          }

          // ุฑูู ูููุฉ ุงูุดููุฏ (ูุทููุจ)
          const martyrNationalId = row['ุฑูู ูููุฉ ุงูุดููุฏ'] || '';
          if (!martyrNationalId || martyrNationalId.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุฑูู ูููุฉ ุงูุดููุฏ', message: 'ุฑูู ูููุฉ ุงูุดููุฏ ูุทููุจ'});
            hasErrors = true;
          } else {
            orphan.martyrNationalId = martyrNationalId.toString().trim();
            
            // ุงูุชุญูู ูู ูุฌูุฏ ุงูุดููุฏ ูู ุงููุธุงู (ุงุฎุชูุงุฑู)
            const martyr = martyrs.find(m => m.nationalId === martyrNationalId.toString().trim());
            if (martyr) {
              orphan.martyrName = martyr.name;
              orphan.martyrdomDate = martyr.martyrdomDate;
            }
          }

          // ุงุณู ุงูุดููุฏ/ุงููุชููู (ูุทููุจ)
          const martyrName = row['ุงุณู ุงูุดููุฏ/ุงููุชููู'] || '';
          if (!martyrName || martyrName.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุงุณู ุงูุดููุฏ/ุงููุชููู', message: 'ุงุณู ุงูุดููุฏ/ุงููุชููู ูุทููุจ'});
            hasErrors = true;
          } else {
            orphan.martyrName = martyrName.toString().trim();
          }

          // ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ (ูุทููุจ)
          const martyrdomDateValue = row['ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ'];
          if (!martyrdomDateValue) {
            errors.push({row: rowNumber, field: 'ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ', message: 'ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ ูุทููุจ'});
            hasErrors = true;
          } else {
            const parsedDate = parseAnyDateFormat(martyrdomDateValue);
            if (!parsedDate) {
              errors.push({
                row: rowNumber, 
                field: 'ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ', 
                message: `ุชุงุฑูุฎ ุงูุงุณุชุดูุงุฏ ุบูุฑ ุตุญูุญ: "${martyrdomDateValue}". ุงุณุชุฎุฏู ุตูุบุฉ ูุซู: 2024-01-15 ุฃู 15/1/2024`
              });
              hasErrors = true;
            } else {
              orphan.martyrdomDate = parsedDate;
            }
          }

          // ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ (ูุทููุจ)
          const maleSiblingsCount = row['ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ'];
          if (maleSiblingsCount === undefined || maleSiblingsCount === null || maleSiblingsCount === '') {
            errors.push({row: rowNumber, field: 'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ', message: 'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ ูุทููุจ'});
            hasErrors = true;
          } else {
            const count = parseInt(maleSiblingsCount);
            if (isNaN(count) || count < 0) {
              errors.push({
                row: rowNumber, 
                field: 'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ', 
                message: `ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฐููุฑ ุบูุฑ ุตุญูุญ: "${maleSiblingsCount}". ูุฌุจ ุฃู ูููู ุฑููุงู ููุฌุจุงู`
              });
              hasErrors = true;
            } else {
              orphan.maleSiblingsCount = count;
            }
          }

          // ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ (ูุทููุจ)
          const femaleSiblingsCount = row['ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ'];
          if (femaleSiblingsCount === undefined || femaleSiblingsCount === null || femaleSiblingsCount === '') {
            errors.push({row: rowNumber, field: 'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ', message: 'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ ูุทููุจ'});
            hasErrors = true;
          } else {
            const count = parseInt(femaleSiblingsCount);
            if (isNaN(count) || count < 0) {
              errors.push({
                row: rowNumber, 
                field: 'ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ', 
                message: `ุนุฏุฏ ุงูุฃุฎูุฉ ุงูุฅูุงุซ ุบูุฑ ุตุญูุญ: "${femaleSiblingsCount}". ูุฌุจ ุฃู ูููู ุฑููุงู ููุฌุจุงู`
              });
              hasErrors = true;
            } else {
              orphan.femaleSiblingsCount = count;
            }
          }

          // ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู (ูุทููุจ)
          const guardianName = row['ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู'] || '';
          if (!guardianName || guardianName.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู', message: 'ุงุณู ุงููุตู ุนูู ุงูุฃูุชุงู ูุทููุจ'});
            hasErrors = true;
          } else {
            orphan.guardianName = guardianName.toString().trim();
          }

          // ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู (ูุทููุจ)
          const guardianRelationship = row['ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู'] || '';
          if (!guardianRelationship || guardianRelationship.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู', message: 'ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู ูุทููุจุฉ'});
            hasErrors = true;
          } else {
            const relationshipStr = guardianRelationship.toString().trim();
            if (guardianRelationships.includes(relationshipStr)) {
              orphan.guardianRelationship = relationshipStr;
            } else {
              errors.push({
                row: rowNumber, 
                field: 'ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุจุงูุฃูุชุงู', 
                message: `ุตูุฉ ูุฑุงุจุฉ ุงููุตู ุบูุฑ ุตุญูุญุฉ: "${relationshipStr}". ุงูููู ุงููุชุงุญุฉ: ${guardianRelationships.join(', ')}`
              });
              hasErrors = true;
            }
          }

          // ุงูุนููุงู (ูุทููุจ)
          const address = row['ุงูุนููุงู'] || '';
          if (!address || address.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุงูุนููุงู', message: 'ุงูุนููุงู ูุทููุจ'});
            hasErrors = true;
          } else {
            orphan.address = address.toString().trim();
          }

          // ุฑูู ุงูุฌูุงู (ูุทููุจ)
          const phone = row['ุฑูู ุงูุฌูุงู'] || '';
          if (!phone || phone.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'ุฑูู ุงูุฌูุงู', message: 'ุฑูู ุงูุฌูุงู ูุทููุจ'});
            hasErrors = true;
          } else {
            orphan.phone = phone.toString().trim();
          }

          // ุงูููุงุญุธุงุช (ุงุฎุชูุงุฑู)
          orphan.notes = (row['ููุงุญุธุงุช'] || '').toString().trim();

          if (!hasErrors) {
            validOrphans.push(orphan);
          }
        });

        resolve({ validOrphans, errors });
      } catch (error) {
        console.error('ุฎุทุฃ ูู ูุฑุงุกุฉ ููู Excel:', error);
        reject(new Error(`ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูููู: ${error instanceof Error ? error.message : 'ุฎุทุฃ ุบูุฑ ูุนุฑูู'}. ุชุฃูุฏ ูู ุฃู ุงูููู ุจุตูุบุฉ Excel ุตุญูุญุฉ.`));
      }
    };

    reader.onerror = () => {
      reject(new Error('ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูููู. ุชุฃูุฏ ูู ุฃู ุงูููู ุบูุฑ ุชุงูู.'));
    };

    reader.readAsArrayBuffer(file);
  });
};

// ุชุตุฏูุฑ ููู ุงูุฃุฎุทุงุก
export const exportOrphansErrorsToExcel = (errors: Array<{row: number, field: string, message: string}>) => {
  const errorData = errors.map((error, index) => ({
    'ุฑูู ุงูุฎุทุฃ': index + 1,
    'ุฑูู ุงูุตู ูู ุงูููู': error.row,
    'ุงูุญูู ุงููุชุฃุซุฑ': error.field,
    'ูุตู ุงููุดููุฉ': error.message,
    'ููุน ุงูุฎุทุฃ': error.field.includes('ุชุงุฑูุฎ') ? 'ุฎุทุฃ ูู ุงูุชุงุฑูุฎ' : 
                  error.field.includes('ุงูุดููุฏ') ? 'ุฎุทุฃ ูู ุจูุงูุงุช ุงูุดููุฏ' : 
                  error.field.includes('ุงููุตู') ? 'ุฎุทุฃ ูู ุจูุงูุงุช ุงููุตู' : 
                  error.field.includes('ุงูุตุญูุฉ') ? 'ุฎุทุฃ ูู ุงูุญุงูุฉ ุงูุตุญูุฉ' : 
                  error.field.includes('ุงูุฏุฑุงุณูุฉ') ? 'ุฎุทุฃ ูู ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ' : 'ุฎุทุฃ ูู ุงูุจูุงูุงุช'
  }));

  const worksheet = XLSX.utils.json_to_sheet(errorData);
  worksheet['!dir'] = 'rtl';
  worksheet['!cols'] = [
    { wch: 12 }, // ุฑูู ุงูุฎุทุฃ
    { wch: 15 }, // ุฑูู ุงูุตู ูู ุงูููู
    { wch: 20 }, // ุงูุญูู ุงููุชุฃุซุฑ
    { wch: 60 }, // ูุตู ุงููุดููุฉ
    { wch: 20 }  // ููุน ุงูุฎุทุฃ
  ];

  // ุฅุถุงูุฉ ูุฑูุฉ ุญููู ููุฃุฎุทุงุก ุงูุดุงุฆุนุฉ
  const solutionsData = [
    { 'ุงูุญููู': '๐ง ุญููู ููุฃุฎุทุงุก ุงูุดุงุฆุนุฉ:' },
    { 'ุงูุญููู': '' },
    { 'ุงูุญููู': '๐ ูุดุงูู ุงูุชุงุฑูุฎ:' },
    { 'ุงูุญููู': 'โข ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ุตูุบุฉ ุตุญูุญุฉ: 2015-05-10 ุฃู 10/5/2015' },
    { 'ุงูุญููู': 'โข ุชุฌูุจ ุชุฑู ุฎุงูุฉ ุงูุชุงุฑูุฎ ูุงุฑุบุฉ' },
    { 'ุงูุญููู': 'โข ุงุณุชุฎุฏู ุชูุงุฑูุฎ ููุทููุฉ' },
    { 'ุงูุญููู': '' },
    { 'ุงูุญููู': '๐ฅ ูุดุงูู ุจูุงูุงุช ุงูุดููุฏ:' },
    { 'ุงูุญููู': 'โข ุชุฃูุฏ ูู ุฅุฏุฎุงู ุฑูู ูููุฉ ุงูุดููุฏ ูุงุณูู ุจุดูู ุตุญูุญ' },
    { 'ุงูุญููู': 'โข ูููู ุงูุงุณุชูุงุฏุฉ ูู ุจูุงูุงุช ุงูุดูุฏุงุก ุงูููุฌูุฏุฉ ูู ุงููุธุงู' },
    { 'ุงูุญููู': 'โข ุฑุงุฌุน ูุฑูุฉ "ุงูุดูุฏุงุก ุงููุชุงุญูู" ููุชูุงุตูู' },
    { 'ุงูุญููู': '' },
    { 'ุงูุญููู': '๐ฅ ูุดุงูู ุงูุญุงูุฉ ุงูุตุญูุฉ ูุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ:' },
    { 'ุงูุญููู': 'โข ุงุณุชุฎุฏู ุงูููู ุงููุญุฏุฏุฉ ููุท ูู ูุฑูุฉ "ุงูุญุงูุงุช ูุงููุฑุงุญู"' },
    { 'ุงูุญููู': 'โข ุชุฃูุฏ ูู ูุชุงุจุฉ ุงููููุฉ ุจุงูุถุจุท ููุง ูู ููุชูุจุฉ' },
    { 'ุงูุญููู': 'โข ูุง ุชุถุน ูุณุงูุงุช ุฅุถุงููุฉ ูุจู ุฃู ุจุนุฏ ุงููููุฉ' },
    { 'ุงูุญููู': '' },
    { 'ุงูุญููู': '๐จโ๐ฉโ๐งโ๐ฆ ูุดุงูู ุจูุงูุงุช ุงููุตู:' },
    { 'ุงูุญููู': 'โข ุชุฃูุฏ ูู ุฅุฏุฎุงู ุงุณู ุงููุตู ูุตูุฉ ูุฑุงุจุชู ุจุดูู ุตุญูุญ' },
    { 'ุงูุญููู': 'โข ุงุณุชุฎุฏู ุตูุงุช ุงููุฑุงุจุฉ ุงููุญุฏุฏุฉ ููุท' },
    { 'ุงูุญููู': '' },
    { 'ุงูุญููู': '๐ ูุตุงุฆุญ ุนุงูุฉ:' },
    { 'ุงูุญููู': 'โข ูุง ุชุชุฑู ุฃู ุญูู ูุทููุจ ูุงุฑุบุงู' },
    { 'ุงูุญููู': 'โข ุงุณุชุฎุฏู ุฃุฑูุงู ุงููููุฉ ููุง ูู ุจุฏูู ุชูุณูู' },
    { 'ุงูุญููู': 'โข ุชุฃูุฏ ูู ุตุญุฉ ุฃุฑูุงู ุงูุฌูุงู' },
    { 'ุงูุญููู': 'โข ูู ุญุงูุฉ ุงุณุชูุฑุงุฑ ุงููุดุงููุ ุฑุงุฌุน ูุฑูุฉ ุงูุชุนูููุงุช ูู ุงููุงูุจ' }
  ];

  const solutionsWorksheet = XLSX.utils.json_to_sheet(solutionsData);
  solutionsWorksheet['!dir'] = 'rtl';
  solutionsWorksheet['!cols'] = [{ wch: 80 }];

  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'ุฃุฎุทุงุก ุงูุงุณุชูุฑุงุฏ');
  XLSX.utils.book_append_sheet(workbook, solutionsWorksheet, 'ุงูุญููู ูุงููุตุงุฆุญ');

  workbook.Props = {
    Title: 'ุฃุฎุทุงุก ุงุณุชูุฑุงุฏ ุงูุฃูุชุงู',
    Subject: 'ุชูุฑูุฑ ููุตู ููุฃุฎุทุงุก ูู ุนูููุฉ ุงุณุชูุฑุงุฏ ุงูุฃูุชุงู ูุน ุงูุญููู',
    Author: 'ูุธุงู ุงููุณุงุนุฏุงุช - ูุทุงุน ุบุฒุฉ',
    CreatedDate: new Date()
  };

  return workbook;
};

// ุชุญููู ููู Excel
export const downloadExcelFile = (workbook: XLSX.WorkBook, filename: string) => {
  const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
  const data = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
  
  const link = document.createElement('a');
  link.href = URL.createObjectURL(data);
  link.download = `${filename}.xlsx`;
  link.click();
  
  // ุชูุธูู ุงูุฐุงูุฑุฉ
  URL.revokeObjectURL(link.href);
};