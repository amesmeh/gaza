import * as XLSX from 'xlsx';
import { MedicalData, Guardian } from '../types';

// Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Excel Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©
export const createMedicalDataTemplate = (guardians: Guardian[]) => {
  const templateData = [
    {
      'Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶': 'Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø§Ù„Ù…',
      'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶': '123456789',
      'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': guardians[0]?.nationalId || '123456789',
      'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ù…Ø²Ù…Ù†',
      'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„': '0597123456',
      'Ù…Ù„Ø§Ø­Ø¸Ø§Øª': 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©'
    }
  ];

  // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ±Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„
  const worksheet = XLSX.utils.json_to_sheet(templateData);

  // ØªØ¹ÙŠÙŠÙ† Ø§ØªØ¬Ø§Ù‡ RTL Ù„Ù„ÙˆØ±Ù‚Ø©
  worksheet['!dir'] = 'rtl';

  // ØªØ¹ÙŠÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
  const columnWidths = [
    { wch: 25 }, // Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶
    { wch: 20 }, // Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶
    { wch: 20 }, // Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    { wch: 20 }, // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶
    { wch: 15 }, // Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
    { wch: 30 }  // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  ];
  worksheet['!cols'] = columnWidths;

  // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ±Ù‚Ø© Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†
  const guardiansData = guardians.map(guardian => ({
    'Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': guardian.id,
    'Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': guardian.name,
    'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': guardian.nationalId,
    'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ': guardian.phone,
    'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©': guardian.area?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    'Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©': guardian.maritalStatus,
    'Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©': guardian.residenceStatus === 'displaced' ? 'Ù†Ø§Ø²Ø­' : 'Ù…Ù‚ÙŠÙ…'
  }));

  const guardiansWorksheet = XLSX.utils.json_to_sheet(guardiansData);
  guardiansWorksheet['!dir'] = 'rtl';
  guardiansWorksheet['!cols'] = [
    { wch: 15 }, // Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    { wch: 25 }, // Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    { wch: 20 }, // Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    { wch: 15 }, // Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    { wch: 20 }, // Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
    { wch: 18 }, // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©
    { wch: 15 }  // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©
  ];

  // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ±Ù‚Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶
  const diseaseTypesData = [
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ù…Ø²Ù…Ù†', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ù…Ø²Ù…Ù†Ø© Ù…ØªÙ†ÙˆØ¹Ø©' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ù‚Ù„Ø¨', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ§Ù„Ø£ÙˆØ¹ÙŠØ© Ø§Ù„Ø¯Ù…ÙˆÙŠØ©' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø±Ø¨Ùˆ', 'Ø§Ù„ÙˆØµÙ': 'Ø§Ù„Ø±Ø¨Ùˆ ÙˆØ£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„ØµØ±Ø¹', 'Ø§Ù„ÙˆØµÙ': 'Ø§Ù„ØµØ±Ø¹ ÙˆØ£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø£Ø¹ØµØ§Ø¨' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠ', 'Ø§Ù„ÙˆØµÙ': 'Ø¯Ø§Ø¡ Ø§Ù„Ø³ÙƒØ±ÙŠ Ø¨Ø£Ù†ÙˆØ§Ø¹Ù‡' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù‰', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„ÙƒÙ„Ù‰ ÙˆØ§Ù„Ù…Ø³Ø§Ù„Ùƒ Ø§Ù„Ø¨ÙˆÙ„ÙŠØ©' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø¶ØºØ·', 'Ø§Ù„ÙˆØµÙ': 'Ø§Ø±ØªÙØ§Ø¹ Ø¶ØºØ· Ø§Ù„Ø¯Ù…' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©', 'Ø§Ù„ÙˆØµÙ': 'Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„ÙƒØ¨Ø¯', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„ÙƒØ¨Ø¯' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù†', 'Ø§Ù„ÙˆØµÙ': 'Ø§Ù„Ø£ÙˆØ±Ø§Ù… Ø§Ù„Ø³Ø±Ø·Ø§Ù†ÙŠØ©' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù‡Ø¶Ù…ÙŠ', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø¹Ø¯Ø© ÙˆØ§Ù„Ø£Ù…Ø¹Ø§Ø¡' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø±Ø¦Ø© ÙˆØ§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø¹Ø¸Ø§Ù…', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¹Ø¸Ø§Ù… ÙˆØ§Ù„Ù…ÙØ§ØµÙ„' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø¹ÙŠÙˆÙ†', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¹ÙŠÙˆÙ†' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø§Ù„Ø£Ø¹ØµØ§Ø¨', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹ØµØ¨ÙŠ' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ù†ÙØ³ÙŠ', 'Ø§Ù„ÙˆØµÙ': 'Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª Ø§Ù„Ù†ÙØ³ÙŠØ©' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø¬Ù„Ø¯ÙŠ', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¬Ù„Ø¯' },
    { 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': 'Ù…Ø±Ø¶ Ø¢Ø®Ø±', 'Ø§Ù„ÙˆØµÙ': 'Ø£Ù…Ø±Ø§Ø¶ Ø£Ø®Ø±Ù‰ ØºÙŠØ± Ù…ØµÙ†ÙØ©' }
  ];

  const diseaseTypesWorksheet = XLSX.utils.json_to_sheet(diseaseTypesData);
  diseaseTypesWorksheet['!dir'] = 'rtl';
  diseaseTypesWorksheet['!cols'] = [
    { wch: 25 }, // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶
    { wch: 40 }  // Ø§Ù„ÙˆØµÙ
  ];

  // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ±Ù‚Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
  const instructionsData = [
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø© Ù„Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©:' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'âœ… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '1. Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ (Ù…Ø·Ù„ÙˆØ¨)' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '2. Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶ (Ù…Ø·Ù„ÙˆØ¨)' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '3. Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Ù…Ø·Ù„ÙˆØ¨)' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '4. Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶ (Ù…Ø·Ù„ÙˆØ¨)' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '5. Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù…Ø·Ù„ÙˆØ¨)' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '6. Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'ğŸ¥ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…ØªØ§Ø­Ø©:' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ù…Ø±Ø¶ Ù…Ø²Ù…Ù†ØŒ Ù…Ø±Ø¶ Ù‚Ù„Ø¨ØŒ Ù…Ø±Ø¶ Ø§Ù„Ø±Ø¨ÙˆØŒ Ù…Ø±Ø¶ Ø§Ù„ØµØ±Ø¹' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠØŒ Ù…Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù‰ØŒ Ù…Ø±Ø¶ Ø§Ù„Ø¶ØºØ·ØŒ Ù…Ø±Ø¶ Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ù…Ø±Ø¶ Ø§Ù„ÙƒØ¨Ø¯ØŒ Ù…Ø±Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù†ØŒ Ù…Ø±Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù‡Ø¶Ù…ÙŠØŒ Ù…Ø±Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ù…Ø±Ø¶ Ø§Ù„Ø¹Ø¸Ø§Ù…ØŒ Ù…Ø±Ø¶ Ø§Ù„Ø¹ÙŠÙˆÙ†ØŒ Ù…Ø±Ø¶ Ø§Ù„Ø£Ø¹ØµØ§Ø¨ØŒ Ù…Ø±Ø¶ Ù†ÙØ³ÙŠØŒ Ù…Ø±Ø¶ Ø¬Ù„Ø¯ÙŠØŒ Ù…Ø±Ø¶ Ø¢Ø®Ø±' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ø±Ø§Ø¬Ø¹ ÙˆØ±Ù‚Ø© "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶" Ù„Ù„ØªÙØ§ØµÙŠÙ„' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Ø´Ø±ÙˆØ· ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±:' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ø±Ø§Ø¬Ø¹ ÙˆØ±Ù‚Ø© "Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†" Ù„Ù„ØªØ£ÙƒØ¯' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'ğŸ”„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©:' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ø³ÙŠØªÙ… Ù‚Ø±Ø§Ø¡ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ Ø£Ùˆ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ Ù„Ø§ ØªØªØ±Ùƒ Ø®Ø§Ù†Ø§Øª ÙØ§Ø±ØºØ© ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': '' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶ Ø¨Ø§Ù„Ø¶Ø¨Ø· ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ÙƒØªÙˆØ¨' },
    { 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª': 'â€¢ ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡ØŒ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹' }
  ];

  const instructionsWorksheet = XLSX.utils.json_to_sheet(instructionsData);
  instructionsWorksheet['!dir'] = 'rtl';
  instructionsWorksheet['!cols'] = [{ wch: 80 }];

  // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØªØ§Ø¨ Ø§Ù„Ø¹Ù…Ù„
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©');
  XLSX.utils.book_append_sheet(workbook, guardiansWorksheet, 'Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†');
  XLSX.utils.book_append_sheet(workbook, diseaseTypesWorksheet, 'Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶');
  XLSX.utils.book_append_sheet(workbook, instructionsWorksheet, 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª');

  // ØªØ¹ÙŠÙŠÙ† Ø®ØµØ§Ø¦Øµ RTL Ù„Ù„ÙƒØªØ§Ø¨
  workbook.Props = {
    Title: 'Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©',
    Subject: 'Ù‚Ø§Ù„Ø¨ Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©',
    Author: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª - Ù‚Ø·Ø§Ø¹ ØºØ²Ø©',
    CreatedDate: new Date()
  };

  return workbook;
};

// ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ© Ø¥Ù„Ù‰ Excel
export const exportMedicalDataToExcel = (medicalData: MedicalData[]) => {
  const exportData = medicalData.map(data => ({
    'Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶': data.patientName,
    'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶': data.patientNationalId,
    'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': data.guardianNationalId,
    'Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': data.guardianName || '',
    'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶': data.diseaseType,
    'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„': data.phone || '',
    'Ù…Ù„Ø§Ø­Ø¸Ø§Øª': data.notes || '',
    'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„': new Date(data.createdAt).toLocaleDateString('ar-EG'),
    'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«': new Date(data.updatedAt).toLocaleDateString('ar-EG')
  }));

  const worksheet = XLSX.utils.json_to_sheet(exportData);
  worksheet['!dir'] = 'rtl';
  
  // ØªØ¹ÙŠÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
  worksheet['!cols'] = [
    { wch: 25 }, // Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶
    { wch: 20 }, // Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶
    { wch: 20 }, // Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    { wch: 25 }, // Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    { wch: 20 }, // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶
    { wch: 15 }, // Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
    { wch: 30 }, // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    { wch: 15 }, // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„
    { wch: 15 }  // Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
  ];

  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©');

  workbook.Props = {
    Title: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©',
    Subject: 'ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©',
    Author: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª - Ù‚Ø·Ø§Ø¹ ØºØ²Ø©',
    CreatedDate: new Date()
  };

  return workbook;
};

// Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ© Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
export const importMedicalDataFromExcel = (file: File, guardians: Guardian[]): Promise<{
  validMedicalData: Partial<MedicalData>[];
  errors: Array<{row: number, field: string, message: string}>;
}> => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    
    reader.onload = (e) => {
      try {
        const data = new Uint8Array(e.target?.result as ArrayBuffer);
        const workbook = XLSX.read(data, { 
          type: 'array', 
          cellDates: false,
          raw: false
        });
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
          raw: false,
          defval: '',
          blankrows: false
        });

        const validMedicalData: Partial<MedicalData>[] = [];
        const errors: Array<{row: number, field: string, message: string}> = [];

        // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…ØªØ§Ø­Ø©
        const diseaseTypes = [
          'Ù…Ø±Ø¶ Ù…Ø²Ù…Ù†',
          'Ù…Ø±Ø¶ Ù‚Ù„Ø¨',
          'Ù…Ø±Ø¶ Ø§Ù„Ø±Ø¨Ùˆ',
          'Ù…Ø±Ø¶ Ø§Ù„ØµØ±Ø¹',
          'Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠ',
          'Ù…Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù‰',
          'Ù…Ø±Ø¶ Ø§Ù„Ø¶ØºØ·',
          'Ù…Ø±Ø¶ Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©',
          'Ù…Ø±Ø¶ Ø§Ù„ÙƒØ¨Ø¯',
          'Ù…Ø±Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù†',
          'Ù…Ø±Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù‡Ø¶Ù…ÙŠ',
          'Ù…Ø±Ø¶ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ',
          'Ù…Ø±Ø¶ Ø§Ù„Ø¹Ø¸Ø§Ù…',
          'Ù…Ø±Ø¶ Ø§Ù„Ø¹ÙŠÙˆÙ†',
          'Ù…Ø±Ø¶ Ø§Ù„Ø£Ø¹ØµØ§Ø¨',
          'Ù…Ø±Ø¶ Ù†ÙØ³ÙŠ',
          'Ù…Ø±Ø¶ Ø¬Ù„Ø¯ÙŠ',
          'Ù…Ø±Ø¶ Ø¢Ø®Ø±'
        ];

        jsonData.forEach((row: any, index: number) => {
          const rowNumber = index + 2;
          const medicalDataItem: Partial<MedicalData> = {};
          let hasErrors = false;

          // Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ (Ù…Ø·Ù„ÙˆØ¨)
          const patientName = row['Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶'] || '';
          if (!patientName || patientName.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶', message: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…Ø·Ù„ÙˆØ¨'});
            hasErrors = true;
          } else {
            medicalDataItem.patientName = patientName.toString().trim();
          }

          // Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶ (Ù…Ø·Ù„ÙˆØ¨)
          const patientNationalId = row['Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶'] || '';
          if (!patientNationalId || patientNationalId.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶', message: 'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…Ø·Ù„ÙˆØ¨'});
            hasErrors = true;
          } else {
            medicalDataItem.patientNationalId = patientNationalId.toString().trim();
          }

          // Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Ù…Ø·Ù„ÙˆØ¨)
          const guardianNationalId = row['Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±'] || '';
          if (!guardianNationalId || guardianNationalId.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±', message: 'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ù…Ø·Ù„ÙˆØ¨'});
            hasErrors = true;
          } else {
            const guardianNationalIdStr = guardianNationalId.toString().trim();
            medicalDataItem.guardianNationalId = guardianNationalIdStr;

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
            const guardian = guardians.find(g => g.nationalId === guardianNationalIdStr);
            if (guardian) {
              medicalDataItem.guardianName = guardian.name;
              
              // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªÙˆÙÙŠØ± Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¢Ø®Ø±
              if (!row['Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„'] || row['Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„'].toString().trim() === '') {
                medicalDataItem.phone = guardian.phone;
              }
            } else {
              errors.push({
                row: rowNumber, 
                field: 'Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±', 
                message: `Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${guardianNationalIdStr}`
              });
              hasErrors = true;
            }
          }

          // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶ (Ù…Ø·Ù„ÙˆØ¨)
          const diseaseType = row['Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶'] || '';
          if (!diseaseType || diseaseType.toString().trim() === '') {
            errors.push({row: rowNumber, field: 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶', message: 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶ Ù…Ø·Ù„ÙˆØ¨'});
            hasErrors = true;
          } else {
            const diseaseTypeStr = diseaseType.toString().trim();
            if (diseaseTypes.includes(diseaseTypeStr)) {
              medicalDataItem.diseaseType = diseaseTypeStr;
            } else {
              errors.push({
                row: rowNumber, 
                field: 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶', 
                message: `Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶ ØºÙŠØ± ØµØ­ÙŠØ­: "${diseaseTypeStr}". Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…ØªØ§Ø­Ø©: ${diseaseTypes.join(', ')}`
              });
              hasErrors = true;
            }
          }

          // Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù…Ø·Ù„ÙˆØ¨)
          const phone = row['Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„'] || '';
          if (phone && phone.toString().trim() !== '') {
            medicalDataItem.phone = phone.toString().trim();
          } else if (!medicalDataItem.phone) {
            errors.push({row: rowNumber, field: 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„', message: 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø·Ù„ÙˆØ¨'});
            hasErrors = true;
          }

          // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          medicalDataItem.notes = (row['Ù…Ù„Ø§Ø­Ø¸Ø§Øª'] || '').toString().trim();

          if (!hasErrors) {
            validMedicalData.push(medicalDataItem);
          }
        });

        resolve({ validMedicalData, errors });
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel:', error);
        reject(new Error(`Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ${error instanceof Error ? error.message : 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© Excel ØµØ­ÙŠØ­Ø©.`));
      }
    };

    reader.onerror = () => {
      reject(new Error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØªØ§Ù„Ù.'));
    };

    reader.readAsArrayBuffer(file);
  });
};

// ØªØµØ¯ÙŠØ± Ù…Ù„Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
export const exportMedicalDataErrorsToExcel = (errors: Array<{row: number, field: string, message: string}>) => {
  const errorData = errors.map((error, index) => ({
    'Ø±Ù‚Ù… Ø§Ù„Ø®Ø·Ø£': index + 1,
    'Ø±Ù‚Ù… Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ù…Ù„Ù': error.row,
    'Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…ØªØ£Ø«Ø±': error.field,
    'ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©': error.message,
    'Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£': error.field === 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶' ? 'Ø®Ø·Ø£ ÙÙŠ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶' : 
                  error.field.includes('ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±') ? 'Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±' : 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'
  }));

  const worksheet = XLSX.utils.json_to_sheet(errorData);
  worksheet['!dir'] = 'rtl';
  worksheet['!cols'] = [
    { wch: 12 }, // Ø±Ù‚Ù… Ø§Ù„Ø®Ø·Ø£
    { wch: 15 }, // Ø±Ù‚Ù… Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ù…Ù„Ù
    { wch: 20 }, // Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…ØªØ£Ø«Ø±
    { wch: 60 }, // ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
    { wch: 20 }  // Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£
  ];

  // Ø¥Ø¶Ø§ÙØ© ÙˆØ±Ù‚Ø© Ø­Ù„ÙˆÙ„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
  const solutionsData = [
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'ğŸ”§ Ø­Ù„ÙˆÙ„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©:' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': '' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'ğŸ¥ Ù…Ø´Ø§ÙƒÙ„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¶:' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙ‚Ø· Ù…Ù† ÙˆØ±Ù‚Ø© "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶"' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†ÙˆØ¹ Ø¨Ø§Ù„Ø¶Ø¨Ø· ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ÙƒØªÙˆØ¨' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ Ù„Ø§ ØªØ¶Ø¹ Ù…Ø³Ø§ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù‚Ø¨Ù„ Ø£Ùˆ Ø¨Ø¹Ø¯ Ø§Ù„Ù†ÙˆØ¹' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': '' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Ù…Ø´Ø§ÙƒÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±:' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ Ø±Ø§Ø¬Ø¹ ÙˆØ±Ù‚Ø© "Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†" Ù„Ù„ØªØ£ÙƒØ¯' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª Ø£Ùˆ Ø±Ù…ÙˆØ²)' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': '' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'ğŸ“± Ù…Ø´Ø§ÙƒÙ„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ†' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…Ø³Ø¬Ù„Ø§Ù‹ ÙƒÙˆÙ„ÙŠ Ø£Ù…Ø±ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': '' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'ğŸ“ Ù†ØµØ§Ø¦Ø­ Ø¹Ø§Ù…Ø©:' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ Ù„Ø§ ØªØªØ±Ùƒ Ø£ÙŠ Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨ ÙØ§Ø±ØºØ§Ù‹' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªÙ†Ø³ÙŠÙ‚' },
    { 'Ø§Ù„Ø­Ù„ÙˆÙ„': 'â€¢ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŒ Ø±Ø§Ø¬Ø¹ ÙˆØ±Ù‚Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ù„Ø¨' }
  ];

  const solutionsWorksheet = XLSX.utils.json_to_sheet(solutionsData);
  solutionsWorksheet['!dir'] = 'rtl';
  solutionsWorksheet['!cols'] = [{ wch: 80 }];

  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
  XLSX.utils.book_append_sheet(workbook, solutionsWorksheet, 'Ø§Ù„Ø­Ù„ÙˆÙ„ ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­');

  workbook.Props = {
    Title: 'Ø£Ø®Ø·Ø§Ø¡ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ©',
    Subject: 'ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¶ÙŠØ© Ù…Ø¹ Ø§Ù„Ø­Ù„ÙˆÙ„',
    Author: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª - Ù‚Ø·Ø§Ø¹ ØºØ²Ø©',
    CreatedDate: new Date()
  };

  return workbook;
};

// ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel
export const downloadExcelFile = (workbook: XLSX.WorkBook, filename: string) => {
  const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
  const data = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
  
  const link = document.createElement('a');
  link.href = URL.createObjectURL(data);
  link.download = `${filename}.xlsx`;
  link.click();
  
  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
  URL.revokeObjectURL(link.href);
};